;;=============================================================================
;; Archivo principal de Eww (versi√≥n reorganizada estilo imagen2)
;;=============================================================================


;; Variables de Eww (stateless data)
(defpoll notes_json :interval "5s"
                    :initial "[]"
 `python3 /home/arelisuleima/.config/eww/scripts/notes_backend.py list`)

(defvar current_note_file "welcome.md")

(defpoll notes_content_pango
  :interval "1s"
  :initial "[]"
  "python3 /home/arelisuleima/.config/eww/scripts/notes_backend.py"
)

;;-----------------------------------------------------------------------------
;; Widgets
;;-----------------------------------------------------------------------------

;; Barra superior (t√≠tulo + bot√≥n cerrar)
(defwidget notes_header []
  (box :orientation "h" 
        :valign "start" 
        :vexpand false  
        :class "header-bar" 
        :spacing 600
        :space-evenly false 
        

       ;; t√≠tulo pegado a la izquierda
       (label :text "üîÆ Pensieve " 
             
               
          )
       ;; bot√≥n pegado a la derecha
       (button :class "close-button" 
               :onclick "eww close notes_window" 
               "X"
              )
  )
)

;; Botones principales
(defwidget notes_controls []
  (box :orientation "h" :spacing 5 :class "notes-controls"  :height 60
    (button :class "new-button"
    
            :onclick "eww update current_note_file=\"$(python3 ~/.config/eww/scripts/notes_backend.py new)\""
            "Nueva")
            
     (button :class "control-button"
            :onclick "kate ~/.config/eww/notes/${current_note_file}"
            "Editar")

    (button :class "delete-button"
            :onclick "python3 ~/.config/eww/scripts/notes_backend.py delete '${current_note_file}' && eww update current_note_file='welcome.md'"
            "Eliminar")
             
   
             
  )
)

;; Lista de notas
(defwidget notes_list []
  ;;(scroll :vscroll true 
    (box :orientation "v"  :spacing 5 
      (for note in notes_json
        (button
           :class "note-item"
           :onclick "~/.config/eww/scripts/select_note.sh '${note.filename}'"
           {note.title}
        )
      )
    )
  ;;)
)

;; Contenido de la nota
(defwidget note_content []
  (scroll :vscroll true :hexpand true :vexpand true :class "note-content-box" 
    (label :class "note-content-label"
           :markup true 
           :wrap true
           :text notes_content_pango
          )
  )
)

;;-----------------------------------------------------------------------------
;; Widget principal
;;-----------------------------------------------------------------------------

(defwidget notes_widget []
  (box 
    :class "main-notes-box"  
    :orientation "vertical"
    :valign "fill"
    :space-evenly false
    :spacing 5
            
    ;; Barra superior
  (notes_header)
  (notes_controls)
    ;; Cuerpo dividido en 2 columnas
    (box :orientation "h"  :spacing 10  :vexpand true 
      ;; Columna izquierda: lista
      (notes_list :width 10)
      (box :orientation "v"   :spacing 5    :vexpand true  
      ;; Columna derecha: contenido de la nota
      (note_content )
      )
    )
  )
)

;;-----------------------------------------------------------------------------
;; Ventana
;;-----------------------------------------------------------------------------

(defwindow notes_window
  :geometry (geometry
    :x "5%"
    :y "5%"
    :width 500
    :height 700
  )
  :stacking "fg"
  :monitor 0
  
  (notes_widget))
